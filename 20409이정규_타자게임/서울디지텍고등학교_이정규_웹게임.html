<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhythm Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            text-align: center;
            overflow-y: hidden;
        }
        #game-container {
            width: 80vw;
            height: 80vh;
            margin: 0 auto;
            margin-top: 10vh;
            padding: 20px;
            border: 1px solid #ccc;
            background-color: #fff;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        .alphabet {
            position: absolute;
            font-size: 10vw;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            opacity: 0; /* Initially hidden */
            z-index: 100000;
        }
        #score, #timer, #high-score {
            font-size: 3vw;
            color: #666;
            position: absolute;
        }
        #score {
            top: 10%;
            left: 5%;
        }
        #timer {
            top: 10%;
            right: 5%;
        }
        #high-score {
            bottom: 5%;
            left: 5%;
            font-size: 2.5vw;
            color: #888;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="alphabet">Ready?</div>
        <div id="score">Score: <span id="score-value">0</span></div>
        <div id="timer">Time: <span id="timer-value">30</span></div>
        <div id="high-score">High Score: <span id="high-score-value">0</span></div>
    </div>

    <script>
        const alphabetElement = document.querySelector('.alphabet');
        const scoree = document.getElementById('score-value');
        const timer = document.getElementById('timer-value');
        const highscoree = document.getElementById('high-score-value');
        let score = 0;
        let targetAlphabet = '';
        let timeLeft = 30;
        let countdown;

        // Show "Ready?" in the center for 3 seconds and then start the game
        function startGame() {
            alphabetElement.style.opacity = 0; // Hide the "Ready?" message
            startCountdown();
            updateAlphabet();
            moveAlphabet(); // Start moving the alphabet
        }

        function showReadyMessage() {
            alphabetElement.textContent = 'Ready?';
            alphabetElement.style.opacity = 1; // Show the "Ready?" message
            setTimeout(startGame, 3000); // Start the game after 3 seconds
        }

        // Initial setup
        showReadyMessage();

        // Event listeners for keydown
        document.addEventListener('keydown', (event) => {
            const pressedKey = event.key.toUpperCase();
            if (pressedKey === targetAlphabet) {
                score++;
                animateScore();
                updateAlphabet();
            } else {
                endGame();
            }
        });

        // Start countdown
        function startCountdown() {
            clearInterval(countdown); // Clear previous interval if exists
            countdown = setInterval(updateTime, 1000);
        }

        // Update time
        function updateTime() {
            timeLeft--;
            timer.textContent = timeLeft;
            if (timeLeft === 0) {
                clearInterval(countdown);
                endGame();
            }
        }

        // Function to update alphabet
        function updateAlphabet() {
            const alphabets = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            targetAlphabet = alphabets[Math.floor(Math.random() * alphabets.length)];
            alphabetElement.textContent = targetAlphabet;
            
            // Random position
            const container = document.getElementById('game-container');
            const containerRect = container.getBoundingClientRect();
            const x = Math.random() * (containerRect.width - alphabetElement.clientWidth);
            const y = Math.random() * (containerRect.height - alphabetElement.clientHeight);
            
            alphabetElement.style.left = `${x}px`;
            alphabetElement.style.top = `${y}px`;
            alphabetElement.style.opacity = 1; // Ensure visible
        }

        // Animate the score
        function animateScore() {
            const initialScale = 1;
            const maxScale = 1.5;
            const animationDuration = 300; // Animation duration in milliseconds
            const startTime = performance.now();

            function step(timestamp) {
                const elapsed = timestamp - startTime;
                const progress = Math.min(elapsed / animationDuration, 1);
                const scale = initialScale + Math.sin(progress * Math.PI) * (maxScale - initialScale);
                scoree.style.transform = `scale(${scale})`;
                
                if (progress < 1) {
                    requestAnimationFrame(step);
                } else {
                    scoree.style.transform = `scale(${initialScale})`; // Reset to initial scale
                    scoree.textContent = score; // Update score value
                }
            }

            requestAnimationFrame(step);
        }

        // Function to end the game
        function endGame() {
            clearInterval(countdown);
            if (score > localStorage.getItem('highScore')) {
                localStorage.setItem('highScore', score);
            }
            highscoree.textContent = localStorage.getItem('highScore') || 0;
            alert(`당신의 점수는 ${score}점\n바로 시작?`);
            location.reload(true);
        }

        // Function to move the alphabet
        function moveAlphabet() {
            const container = document.getElementById('game-container');
            const containerRect = container.getBoundingClientRect();
            const alphabetRect = alphabetElement.getBoundingClientRect();
            let x = parseFloat(alphabetElement.style.left) || 0;
            let y = parseFloat(alphabetElement.style.top) || 0;
            let dx = (Math.random() - 0.5) * 2; // Random x direction
            let dy = (Math.random() - 0.5) * 2; // Random y direction

            function animate() {
                const newX = x + dx;
                const newY = y + dy;

                // Check for collisions with the container edges
                if (newX < 0 || newX + alphabetElement.clientWidth > containerRect.width) {
                    dx = -dx; // Reverse x direction
                }
                if (newY < 0 || newY + alphabetElement.clientHeight > containerRect.height) {
                    dy = -dy; // Reverse y direction
                }

                x += dx;
                y += dy;

                alphabetElement.style.left = `${x}px`;
                alphabetElement.style.top = `${y}px`;

                requestAnimationFrame(animate);
            }

            animate();
        }

        // Set initial high score
        highscoree.textContent = localStorage.getItem('highScore') || 0;
    </script>
</body>
</html>
